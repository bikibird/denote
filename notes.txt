
Poking memory from Javascript: https://www.lexaloffle.com/bbs/?tid=3339
Triggering GPIO pins https://www.lexaloffle.com/bbs/?tid=3909

Javascript side:

Poke SFX/Music into memory.  Poke cart data with a flag.

PICO Cartridge side:

	Init function: set cart data flag to zero.

	Update function: 
		Read cart data flag. 
		If flag greater than zero, play music.
		After music done playing, set flag to zero.

Javascript:
	On click, restart cart.
	Write sfx/music data to memory.
	Set  cart data flag to one.
	

Javascript side

PICO-8 speed = # of ticks per note.  1 tick = 1/120 seconds or 120 ticks per second

MIDI ppq # of ticks per quarer note.  

One beat is a quarter note, and a pulse is a tick, so with 100 BPM and 960 PPQ, you have 100 Ã— 960 = 96000 ticks per minute. This is 96000 / 60 = 1600 ticks per second.
So the time, in seconds, is 34560 / 1600 = 21.6 s; the duration is 1920 / 1600 = 1.2 s.

if tempo is 78 bpm  ppq=256 ticks per quarter note and smallest note is 32 ticks, what speed in PICO-8?

(60*120/tempo)*smallest note/ppq= pico speed

(7200/78)*(32/256)=11.53 round up to 12

numerator=7200*smallest ticks/ppq

numerator/tempo

speed=Math.floor((7200/ppq)*ticks/bpm)
Calculate pulses per p8 note ppp8

track[track.trackIndex].durationTicks
-----------------------------------------------------------
resolution


There are 64 SFX ("sound effects") in a cartridge, used for both sound and music.
	
	Each SFX has 32 notes, and each note has:
		A frequency   (C0..C5)
		An instrument (0..7)
		A volume      (0..7)
		An effect     (0..7)
	
	Each SFX also has these properties:
	
		A play speed (SPD) : the number of 'ticks' to play each note for.
			// This means that 1 is fastest, 3 is 3x as slow, etc.

		Loop start and end : this is the note index to loop back and to
			// Looping is turned off when the start index >= end index

		When only the first of the 2 numbers is used (and the second one is 0),
		it is taken to mean the number of notes to be played. This is normally
		not needed for sound effects (you can just leave the remaining notes
		empty), but is useful for controlling music playback.

Each note is encoded in 16 bits, in Little Endian style, with the low 8 bits in the first byte, and the high 8 bits in the second, formatted like so:

Second byte / High 8 bits	c	e	e	e	v	v	v	w   First byte / Low 8 bits	w	w	p	p	p	p	p	p 
c: when c is 1, waveform is a custom instrument corresponding to sfx 0-7; otherwise it is one of the eight built-in waveforms (PICO-8 0.1.11+)
eee: effect (0-7)
vvv: volume (0-7)
www: waveform (0-7)
pppppp: pitch (0-63)

Effect: 
0: 0		
1: 4096		
2: 8192		
3: 12388	
4: 16384	
5: 20480	
6: 24576	
7: 28762	

Volume:
0: 0
1: 512
2: 1024
3: 1536
4: 2048
5: 2560
6: 3072
7: 3584

instrument:
0: 0	c0: 32768
1: 64	c1: 32832
2: 128	c2: 32896
3: 192	c3: 32960
4: 256	c4: 33024
5: 320	c5: 33088
6: 384	c6: 33152
7: 448	c7: 33216

[sfx]0200000000030a040a0000060a00000a0a00000d0a0000100a130a0000160a180a00001b0a1d0a1e0a200a240a260a270a2a0a2b0a2e0a2f0a310a330a350a360a370a00190000013c0a3a0a380a340a320a300a2e0a2b0a160a290a270a250a240a230a220a210a200a1f0a1e0a1c0a1b0a190a170a160a150a140a120a110a100a100a0f0a0d0a00100000[/sfx]

[sfx]01000000000a210a210a1f0a1f0a210a210a240a230a210a210a1f0a1f0a210a210a210a210a240a240a230a230a240a240a280a260a240a240a230a230a210a230a240a260000[/sfx]
0a210a210a1f0a1f0a210a210a240a230a210a210a1f0a1f0a210a210a210a210a240a240a230a230a240a240a280a260a240a240a230a230a210a230a240a260a280a280a260a260a280a280a2b0a290a280a280a260a260a280a280a280a280a280a280a260a260a240a240a230a230a210a210a1f0a1f0a210a210a210a210a210a210a1f0a1f0a210a210a1c0a1c0a1d0a1d0a1f0a1f0a210a210a210a210a240a240a230a230a240a240a280a260a240a240a230a230a210a230a240a260a280a280a260a260a280a280a2b0a290a280a280a260a260a280a280a280a280a280a280a260a260a240a240a230a230a210a210a1f0a1f

[sfx]0100003c03900390039003900340034003400340037003700370037002f002f002f002f0000000000000000000000000000000000000000000000000000000000000000000[/sfx]

[sfx]0100000000210021001f001f002100210024002300210021001f001f0021002100210021002400240023002300240024002800260024002400230023002100230024002600000000[/sfx]

210021001f001f002100210024002300210021001f001f00210021002100210024002400230023002400240028002600240024002300230021002300240026002800280026002600280028002b0029002800280026002600280028002800280028002800260026002400240023002300210021001f001f002100210021002100210021001f001f00210021001c001c001d001d001f001f00210021002100210024002400230023002400240028002600240024002300230021002300240026002800280026002600280028002b0029002800280026002600280028002800280028002800260026002400240023002300210021001f001f00

00210021001f001f002100210024002300210021001f001f00210021002100210024002400230023002400240028002600240024002300230021002300240026002800280026002600280028002b0029002800280026002600280028002800280028002800260026002400240023002300210021001f001f002100210021002100210021001f001f00210021001c001c001d001d001f001f00210021002100210024002400230023002400240028002600240024002300230021002300240026002800280026002600280028002b0029002800280026002600280028002800280028002800260026002400240023002300210021001f001f

[sfx]0100004c0a490a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000[/sfx]
[sfx]0100004c0a490a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003100000[/sfx]
[sfx]0100004c0a490a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005100000[/sfx]
[sfx]0100004c0a490a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 0951 00000[/sfx]

[sfx]0403013c0a3a0a380a340a320a300a2e0a2b0a160a290a270a250a240a230a220a210a200a1f0a1e0a1c0a1b0a190a170a160a150a140a120a110a100a100a0f0a0d0a0010000002050a080a0a0a0d0a0f0a110a130a140a160a170a180a1a0a1a0a1c0a1d0a1f0a210a0000230a260a280a290a2b0a2d0a2e0a300a320a340a370a390a3b0a3e0a00100000034c0a490a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000095100000044a0a4d0a730a580a5a0a5d0a5f0a650a690a6b0a6d0a6f0a700a720a740a750a770a790a7a0a580b660b7a0a780a760a6f0a530a4f0a4d0a6d0a6c0a650a000000100000010203040020203040010203040[/sfx]

[sfx]0101013c0a3a0a380a340a320a300a2e0a2b0a160a290a270a250a240a230a220a210a200a1f0a1e0a1c0a1b0a190a170a160a150a140a120a110a100a100a0f0a0d0a00100000014243440[/sfx]

[sfx]0404013c0a3a0a380a340a320a300a2e0a2b0a160a290a270a250a240a230a220a210a200a1f0a1e0a1c0a1b0a190a170a160a150a140a120a110a100a100a0f0a0d0a0010000002050a080a0a0a0d0a0f0a110a130a140a160a170a180a1a0a1a0a1c0a1d0a1f0a210a0000230a260a280a290a2b0a2d0a2e0a300a320a340a370a390a3b0a3e0a00100000034c0a490a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000095100000044a0a4d0a730a580a5a0a5d0a5f0a650a690a6b0a6d0a6f0a700a720a740a750a770a790a7a0a580b660b7a0a780a760a6f0a530a4f0a4d0a6d0a6c0a650a000000100000010203040020203041010203040014243442[/sfx]

[sfx]0001414243440[/sfx]

[sfx]0100007d0b7d0b7c0b7b0b7a0b7a0b790b780b770b770b760b760b760b760b150a770177017801790179017a017a017a017a017a017a017901790179017b017c017d010010000f[/sfx]

[sfx]010000
3e00
3c00
3a00
3900
3700
3600
3200
3400
3100
3002
2f02
2d02
2c02
2b02
2a02
2902
2804
2604
2304
2204
2004
1d04
1b06
1906
1708
1608
150a
120a
100a
0e0e
090e
060e
0010
0000[/sfx]
0011 1110 0000 0000
0011 0000 0000 0010
0000 0110 1110 0000

lowiipp pppp ceee vvvi hi
ii        i       i
[sfx] 
instrument custom 6
10xx xxxx cxxx xxx1
instrument 6
10xx xxxx 0xxx xxx1
instrument 4
00xx xxxx 0xxx xxx1
instrument 2
10xx xxxx 0xxx xxx0
instrument 1
01xx xxxx 0xxx xxx0




[sfx]countSFX countMusic (SFX#referenceNumberInMusicSection (Notes) Filter speed LoopStart LoopEnd)[/sfx]

[sfx]0201003f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a00070000013f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a00100000000143440[/sfx]

[sfx]0201013f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a00100000003f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a3f0a00070000010083840[/sfx]
00210a210a1f0a1f0a210a210a240a230a210a210a1f0a1f0a210a210a210a210a240a240a230a230a240a240a280a260a240a240a230a230a210a230a240a260a002f0000

210a210a1f0a1f0a210a210a240a230a210a210a1f0a1f0a210a210a210a210a240a240a230a230a240a240a280a260a240a240a230a230a210a230a240a260a280a280a260a260a280a280a2b0a290a280a280a260a260a280a280a280a280a280a280a260a260a240a240a230a230a210a210a1f0a1f0a210a210a210a210a210a210a1f0a1f0a210a210a1c0a1c0a1d0a1d0a1f0a1f0a210a210a210a210a240a240a230a230a240a240a280a260a240a240a230a230a210a230a240a260a280a280a260a260a280a280a2b0a290a280a280a260a260a280a280a280a280a280a280a260a260a240a240a230a230a210a210a1f0a1f0a

00210a210a1f0a1f0a210a210a240a230a210a210a1f0a1f0a210a210a210a210a240a240a230a230a240a240a280a260a240a240a230a230a210a230a240a260a002f000001280a280a260a260a280a280a2b0a290a280a280a260a260a280a280a280a280a280a280a260a260a240a240a230a230a210a210a1f0a1f0a210a210a210a210a002f000002210a210a1f0a1f0a210a210a1c0a1c0a1d0a1d0a1f0a1f0a210a210a210a210a240a240a230a230a240a240a280a260a240a240a230a230a210a230a240a260a002f000003280a280a260a260a280a280a2b0a290a280a280a260a260a280a280a280a280a280a280a260a260a240a240a230a230a210a210a1f0a1f0a002f0000

[sfx]040000210a210a1f0a1f0a210a210a240a230a210a210a1f0a1f0a210a210a210a210a240a240a230a230a240a240a280a260a240a240a230a230a210a230a240a260a002f000001280a280a260a260a280a280a2b0a290a280a280a260a260a280a280a280a280a280a280a260a260a240a240a230a230a210a210a1f0a1f0a210a210a210a210a002f000002210a210a1f0a1f0a210a210a1c0a1c0a1d0a1d0a1f0a1f0a210a210a210a210a240a240a230a230a240a240a280a260a240a240a230a230a210a230a240a260a002f000003280a280a260a260a280a280a2b0a290a280a280a260a260a280a280a280a280a280a280a260a260a240a240a230a230a210a210a1f0a1f0a002f000004210a210a210a210a00370000[/sfx]

00210a210a1f0a1f0a210a210a240a230a210a210a1f0a1f0a210a210a210a210a240a240a230a230a240a240a280a260a240a240a230a230a210a230a240a260a002f000001280a280a260a260a280a280a2b0a290a280a280a260a260a280a280a280a280a280a280a260a260a240a240a230a230a210a210a1f0a1f0a210a210a210a210a002f000002210a210a1f0a1f0a210a210a1c0a1c0a1d0a1d0a1f0a1f0a210a210a210a210a240a240a230a230a240a240a280a260a240a240a230a230a210a230a240a260a002f000003280a280a260a260a280a280a2b0a290a280a280a260a260a280a280a280a280a280a280a260a260a240a240a230a230a210a210a1f0a1f0a002f000004210a210a210a210a00370000"

[sfx]040000210a210a1f0a1f0a210a210a240a230a210a210a1f0a1f0a210a210a210a210a240a240a230a230a240a240a280a260a240a240a230a230a210a230a240a260a002f000001280a280a260a260a280a280a2b0a290a280a280a260a260a280a280a280a280a280a280a260a260a240a240a230a230a210a210a1f0a1f0a210a210a210a210a002f000002210a210a1f0a1f0a210a210a1c0a1c0a1d0a1d0a1f0a1f0a210a210a210a210a240a240a230a230a240a240a280a260a240a240a230a230a210a230a240a26000a2f000003280a280a260a260a280a280a2b0a290a280a280a260a260a280a280a280a280a280a280a260a260a240a240a230a230a210a210a1f0a1f0a0000000000000000002f0000[/sfx]

[sfx]040000210a210a210a210a1f0a1f0a1f0a1f0a210a210a210a210a240a240a230a230a210a210a210a210a1f0a1f0a1f0a1f0a210a210a210a210a210a210a210a210a002f000001240a240a240a240a230a230a230a230a240a240a240a240a280a280a260a260a240a240a240a240a230a230a230a230a210a210a230a230a240a240a260a260a002f000002280a280a280a280a260a260a260a260a280a280a280a280a2b0a2b0a290a290a280a280a280a280a260a260a260a260a280a280a280a280a280a280a280a280a002f000003280a280a280a280a260a260a260a260a240a240a240a240a230a230a230a230a210a210a210a210a1f0a1f0a1f0a1f0a210a210a210a210a210a210a210a210a002f0000[/sfx]

[sfx]040400210a210a210a210a1f0a1f0a1f0a1f0a210a210a210a210a240a240a230a230a210a210a210a210a1f0a1f0a1f0a1f0a210a210a210a210a210a210a210a210a002f000001240a240a240a240a230a230a230a230a240a240a240a240a280a280a260a260a240a240a240a240a230a230a230a230a210a210a230a230a240a240a260a260a002f000002280a280a280a280a260a260a260a260a280a280a280a280a2b0a2b0a290a290a280a280a280a280a260a260a260a260a280a280a280a280a280a280a280a280a002f000003280a280a280a280a260a260a260a260a240a240a240a240a230a230a230a230a210a210a210a210a1f0a1f0a1f0a1f0a210a210a210a210a210a210a210a210a002f0000
00 42 43 44 0
01 42 43 44 0
02 42 43 44 0
03 42 43 44 0[/sfx]

There are 64 music patterns. Each music pattern uses four bytes to assign a sound effect or silence to each of four channels. (4 * 64 = 256 bytes.)

If a sound effect is assigned to a channel, bit 6 is 0, and bits 5-0 are the sound ID (0 through 63). If the channel is silent, bit 6 is 1, and bits 5-0 are not used.

Bit 7 is used to describe the flags for the music pattern. Bit 7 of the first byte (channel 1) is "begin pattern loop." Bit 7 of the second byte (channel 2) is "end pattern loop." Bit 7 of the third byte (channel 3) is "stop at end of pattern." (Bit 7 of the fourth byte is unused.)

0: begin pattern loop
1: end pattern loop
2: stop at end of pattern
The sound effect ID is in the range 0-63. If a channel is silent for a song pattern, its number is 64 + the channel number (0x41, 0x42, 0x43, or 0x44).

Music Pattern
channel1Sfx#, channel2Sfx# , channel3Sfx#, channel4Sfx#, (looping nibble)

if Channel is muted Sfx # >63

[sfx]040400210a210a210a210a1f0a1f0a1f0a1f0a210a210a210a210a240a240a230a230a210a210a210a210a1f0a1f0a1f0a1f0a210a210a210a210a210a210a210a210a002f000001240a240a240a240a230a230a230a230a240a240a240a240a280a280a260a260a240a240a240a240a230a230a230a230a210a210a230a230a240a240a260a260a002f000002280a280a280a280a260a260a260a260a280a280a280a280a2b0a2b0a290a290a280a280a280a280a260a260a260a260a280a280a280a280a280a280a280a280a002f000003280a280a280a280a260a260a260a260a240a240a240a240a230a230a230a230a210a210a210a210a1f0a1f0a1f0a1f0a210a210a210a210a210a210a210a210a002f0000

00 42 43 44 1 
01 42 43 44 0
02 42 43 44 0 
03 42 43 44 2

[sfx]040403280a280a280a280a260a260a260a260a240a240a240a240a230a230a230a230a210a210a210a210a1f0a1f0a1f0a1f0a210a210a210a210a210a210a210a210a002f000002280a280a280a280a260a260a260a260a280a280a280a280a2b0a2b0a290a290a280a280a280a280a260a260a260a260a280a280a280a280a280a280a280a280a002f000001240a240a240a240a230a230a230a230a240a240a240a240a280a280a260a260a240a240a240a240a230a230a230a230a210a210a230a230a240a240a260a260a002f000000210a210a210a210a1f0a1f0a1f0a1f0a210a210a210a210a240a240a230a230a210a210a210a210a1f0a1f0a1f0a1f0a210a210a210a210a210a210a210a210a002f0000
03 42 43 44 1 
02 42 43 44 0
01 42 43 44 0
00 01 02 03 2[/sfx]

[sfx]010110240a240a240a240a240a240a240a240a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000171000104040401[/sfx]

[sfx]010110240a240a240a240a240a240a240a240a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000171000104040402[/sfx]

[sfx]010110240a240a240a240a240a240a240a240a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000171000104040404[/sfx]


[sfx]0a08003059305930593059105910591059105930593059305930596059605950595059305930593059305910591059105910593059305930593059305930593059305900180000010036003600360036003600360036003600360036003600360036003600360036003600360036003600360036003600360036003600360036003600360036003600180000026059605960596059505950595059505960596059605960590060006080598059605960596059605950595059505950593059305950595059605960598059805900180000030060006000600060805980598059805900600060006000603060306010601060006000600060006080598059805980590060006000600060006000600060006000180000040060006000600060805980598059805960596059605960595059505950595059305930593059305910591059105910593059305930593059305930593059305900180000053059305930593059105910591059105930593059305930598058805880588058905890589058905810591059105910593059305930593059305930593059305900180000060060006000600060805980598059805960596059605960595059505950595059305930593059305910591059105910590000000000000000000000000000000000181800070060006000600060805980598059805900600060006000603060306010601060006000600060006080598059805980590000000000000000000000000000000000181800086059605960596059505950595059505960596059605960590060006080598059605960596059605950595059505950590000000000000000000000000000000000181800093059305930593059105910591059105930593059305930598058805880588058905890589058905810591059105910590000000000000000000000000000000000181800000101010020001010030200010040302000050403020020504030030205040060708092[/sfx]